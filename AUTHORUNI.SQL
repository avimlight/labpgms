CREATE DATABASE UNINIYA
USE UNINIYA
CREATE TABLE AUTHOR1(
AUTHORID INT,
AUTHORNAME VARCHAR(20),
AUTHORCITY VARCHAR(20),
AUTHORCOUNTRY VARCHAR(20),
PRIMARY KEY(AUTHORID)
)
CREATE TABLE PUBLISHER1(
PUBLISHERID INT,
PUBLISHERNAME VARCHAR(20),
PUBLISHERCITY VARCHAR(20),
PUBLISHERCOUNTRY VARCHAR(20),
PRIMARY KEY(PUBLISHERID)
)
CREATE TABLE CATEGORY1(
CATEGORYID INT,
DESCRIPTION VARCHAR(20),
PRIMARY KEY(CATEGORYID)
)
CREATE TABLE CATALOG1(
BOOKID INT,
TITLE VARCHAR(20),
AUTHORID INT,
PUBLISHERID INT,
CATEGORYID INT,
YEAR INT,
PRICE INT,
PRIMARY KEY(BOOKID),
FOREIGN KEY(AUTHORID) REFERENCES AUTHOR1(AUTHORID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(PUBLISHERID) REFERENCES PUBLISHER1(PUBLISHERID) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(CATEGORYID) REFERENCES CATEGORY1(CATEGORYID) ON DELETE CASCADE ON UPDATE CASCADE
)
CREATE TABLE ORDERDETAILS1(
ORDERNO INT,
BOOKID INT,
QTY INT,
PRIMARY KEY(ORDERNO,BOOKID),
FOREIGN KEY(BOOKID) REFERENCES CATALOG1(BOOKID) ON DELETE CASCADE ON UPDATE CASCADE
)
INSERT INTO AUTHOR1 VALUES(101,'AUTHOR1','AUTHORCITY1','AUTHORCOUNTRY1'),(102,'AUTHOR2','AUTHORCITY2','AUTHORCOUNTRY2'),(103,'AUTHOR3','AUTHORCITY3','AUTHORCOUNTRY3')
INSERT INTO PUBLISHER1 VALUES(201,'PUBLISHER1','PUBCITY1','PUBCTY1'),(202,'PUBLISHER2','PUBCITY2','PUBCTY2'),(203,'PEARSON','PUBCITY3','PUBCTY3')
INSERT INTO CATEGORY1 VALUES(301,'SCIFI'),(302,' NON FICTION'),(303,'FICTION')
INSERT INTO CATALOG1 VALUES(401,'BOOK1',101,201,301,2005,50),(402,'BOOK2',101,202,302,2006,60),(403,'BOOK3',102,201,303,2007,70),(404,'BOOK4',102,203,301,2008,80),(405,'BOOK5',103,201,302,2009,90),(406,'BOOK6',103,202,303,2010,100)
INSERT INTO ORDERDETAILS1 VALUES(501,401,5),(501,402,6),(502,403,4),(502,404,8),(503,405,7),(503,406,7)

SELECT A.AUTHORID,A.AUTHORNAME,A.AUTHORCITY,C.BOOKID,SUM(O.QTY) AS 'SUM_QTY' INTO TB_AUTH FROM AUTHOR1 A, CATALOG1 C,ORDERDETAILS1 O WHERE A.AUTHORID=C.AUTHORID AND C.BOOKID=O.BOOKID GROUP BY A.AUTHORID,A.AUTHORNAME,A.AUTHORCITY,C.BOOKID 
SELECT *FROM TB_AUTH WHERE SUM_QTY IN (SELECT MAX(SUM_QTY) FROM TB_AUTH)

UPDATE CATALOG1 SET PRICE=PRICE*1.1 WHERE PUBLISHERID IN (SELECT PUBLISHERID FROM PUBLISHER1 WHERE PUBLISHERNAME='PEARSON')
SELECT *FROM CATALOG1

SELECT COUNT(ORDERNO) AS 'NO OF ORDERS', BOOKID FROM ORDERDETAILS1  GROUP BY BOOKID HAVING SUM(QTY)<=ALL(SELECT SUM(QTY) FROM ORDERDETAILS1 GROUP BY BOOKID)
