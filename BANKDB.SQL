CREATE DATABASE UHG
USE UHG

CREATE TABLE BRANCH(
BRANCHNAME VARCHAR(20),
BRANCHCITY VARCHAR(20),
ASSETS REAL,
PRIMARY KEY(BRANCHNAME)
)
INSERT INTO BRANCH VALUES('SYNDMNG','MANGALORE',100000.0),('CORPMNG','MANGALORE',200000.0),('CANARAMNG','MANGALORE',300000.0),('SBIUDUPI','UDUPI',400000.0),('SYNDNITTE','KARKALA',500000.0)

CREATE TABLE ACCOUNT(
ACCNO INT,
BRANCHNAME VARCHAR(20),
BALANCE REAL,
PRIMARY KEY(ACCNO),
FOREIGN KEY(BRANCHNAME) REFERENCES BRANCH(BRANCHNAME) ON DELETE CASCADE ON UPDATE CASCADE
)
INSERT INTO ACCOUNT VALUES(1,'SYNDMNG',5000.0),(2,'SBIUDUPI',3000.0),(3,'SYNDNITTE',2000.0),(4,'SYNDNITTE',6000.0),(5,'SYNDNITTE',7000.0),(6,'SYNDMNG',4000.0),(7,'CORPMNG',5000.0)
CREATE TABLE CUSTOMER(
CUSTOMERNAME VARCHAR(20),
CUSTOMERSTREET VARCHAR(20),
CUSTOMERCITY VARCHAR(20),
PRIMARY KEY(CUSTOMERNAME)
)
INSERT INTO CUSTOMER VALUES('AVINASH','S1','UDUPI'),('ABHIJEETH','S2','MANGALORE'),('UNINI','S3','KARKALA')
CREATE TABLE DEPOSITOR(
CUSTOMERNAME VARCHAR(20),
ACCNO INT,
PRIMARY KEY(CUSTOMERNAME,ACCNO),
FOREIGN KEY(ACCNO) REFERENCES ACCOUNT(ACCNO) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(CUSTOMERNAME) REFERENCES CUSTOMER(CUSTOMERNAME) ON DELETE CASCADE ON UPDATE CASCADE
)
INSERT INTO DEPOSITOR VALUES('AVINASH',1),('AVINASH',2),('AVINASH',3),('ABHIJEETH',4),('ABHIJEETH',5),('UNINI',6),('UNINI',7)
CREATE TABLE LOANS(
LOANNUMBER INT,
BRANCHNAME VARCHAR(20),
AMOUNT REAL,
PRIMARY KEY(LOANNUMBER),
FOREIGN KEY(BRANCHNAME) REFERENCES BRANCH(BRANCHNAME) ON DELETE CASCADE ON UPDATE CASCADE,
)
INSERT INTO LOANS VALUES(123,'CORPMNG',100000.0)

CREATE TABLE BORROWER(
CUSTOMERNAME VARCHAR(20),
LOANNUMBER INT,
PRIMARY KEY(CUSTOMERNAME,LOANNUMBER),
FOREIGN KEY(CUSTOMERNAME) REFERENCES CUSTOMER(CUSTOMERNAME) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(LOANNUMBER) REFERENCES LOANS(LOANNUMBER) ON DELETE CASCADE ON UPDATE CASCADE

)
INSERT INTO BORROWER VALUES('AVINASH',123)

SELECT C.CUSTOMERNAME  FROM CUSTOMER C WHERE NOT EXISTS(
(SELECT B.BRANCHNAME FROM BRANCH B WHERE B.BRANCHCITY='KARKALA')
EXCEPT
(
SELECT A.BRANCHNAME FROM ACCOUNT A,DEPOSITOR D,BRANCH B1 WHERE D.ACCNO=A.ACCNO AND  A.BRANCHNAME=B1.BRANCHNAME AND D.CUSTOMERNAME=C.CUSTOMERNAME GROUP BY A.BRANCHNAME HAVING COUNT(*)>=2
)

)
SELECT C.CUSTOMERNAME FROM CUSTOMER C WHERE NOT EXISTS(
(SELECT DISTINCT(B.BRANCHCITY) FROM BRANCH B )
EXCEPT
(SELECT B1.BRANCHCITY FROM BRANCH B1,ACCOUNT A, DEPOSITOR D WHERE A.BRANCHNAME=B1.BRANCHNAME AND D.ACCNO=A.ACCNO AND D.CUSTOMERNAME=C.CUSTOMERNAME GROUP BY B1.BRANCHCITY HAVING COUNT(*)>=1)
)
SELECT C.CUSTOMERNAME FROM CUSTOMER C WHERE EXISTS(
SELECT COUNT(DISTINCT(B.BRANCHNAME))  FROM BRANCH B,ACCOUNT A,DEPOSITOR D WHERE A.BRANCHNAME=B.BRANCHNAME AND D.ACCNO=A.ACCNO AND B.BRANCHCITY='MANGALORE' AND D.CUSTOMERNAME=C.CUSTOMERNAME GROUP BY B.BRANCHCITY HAVING COUNT(*)>=2
)