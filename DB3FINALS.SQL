CREATE DATABASE SDFA;
USE SDFA;
CREATE TABLE STUDENT3(
REGNO VARCHAR(20),
NAME VARCHAR(20),
MAJOR VARCHAR(20),
BDATE DATE,
PRIMARY KEY(REGNO)
)
INSERT INTO STUDENT3 VALUES('S01','JOHN SMITH','COMPUTERS','2000-01-01'),('S02','BOB JOHNSON','ELELCTRICALENG','2000-02-01'),('S03','BOB MAYER','COMPUTERS','2000-03-01'),('S04','BOB MAYER','ELELCTRICALENG','2000-04-01'),('S05','BOBY DEOL','COMPUTERS','2000-05-01')
CREATE TABLE COURSE3(
COURSENO INT,
COURSENAME VARCHAR(20),
DEPT VARCHAR(20),
PRIMARY KEY(COURSENO)
)
INSERT INTO COURSE3 VALUES(101,'INTRO TO DBMS','CS'),(102,'INTRO TO OS','CS'),(103,'INTRO TO MP','CS'),(104,'INTRO TO JAVA','CS'),(105,'DSD','EE'),(106,'INTRO TO GATES','EE')
CREATE TABLE ENROLL3(
REGNO VARCHAR(20),
COURSENO INT,
SEM INT,
MARKS INT,
PRIMARY KEY(REGNO,COURSENO,SEM),
FOREIGN KEY(REGNO) REFERENCES STUDENT3(REGNO) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(COURSENO) REFERENCES COURSE3(COURSENO) ON DELETE CASCADE ON UPDATE CASCADE
)
INSERT INTO ENROLL3 VALUES('S01',101,1,90),('S01',102,1,91),('S02',101,1,92),('S02',102,1,93),('S03',101,1,94),('S03',102,1,95),('S04',102,2,94),('S04',103,2,95),('S05',102,2,94),('S05',103,2,95)
CREATE TABLE TEXTBOOK3(
BOOKISBN INT,
BOOKTITLE VARCHAR(20),
PUBLISHER VARCHAR(20),
AUTHOR VARCHAR(20),
PRIMARY KEY(BOOKISBN)
)
INSERT INTO TEXTBOOK3 VALUES(123,'INTRO TO DATA','MCGRAWHILL','ALAN THOMAS'),(456,'INTRO TO JAVA','MCGRAWHILL','ALAN VICTOR'),(789,'INTRO TO DSD','MITPRESS','SUBRATAPAL'),(367,'INTRO TO SYSTEM','MITPRESS','REWDAMACH'),(798,'INTRO TO WIRING','MITPRESS','SUNILCARDOZA')

CREATE TABLE BOOKADAPTION3(
COURSENO INT,
SEM INT,
BOOKISBN INT,
PRIMARY KEY(COURSENO,SEM,BOOKISBN),
FOREIGN KEY(COURSENO) REFERENCES COURSE3(COURSENO) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(BOOKISBN) REFERENCES TEXTBOOK3(BOOKISBN) ON DELETE CASCADE ON UPDATE CASCADE
)
INSERT INTO BOOKADAPTION3 VALUES(101,1,123),(101,1,456),(101,1,789),(102,1,123),(102,1,456),(103,1,789),(103,1,123),(104,1,456),(104,2,123),(105,2,123),(105,2,456)

SELECT DISTINCT(T.BOOKISBN),T.BOOKTITLE,C.COURSENO,C.COURSENAME FROM TEXTBOOK3 T,COURSE3 C,BOOKADAPTION3  B WHERE B.BOOKISBN=T.BOOKISBN AND C.COURSENO=B.COURSENO AND C.DEPT='CS' AND C.COURSENO IN (SELECT COURSENO FROM BOOKADAPTION3 GROUP BY COURSENO HAVING  COUNT(DISTINCT(BOOKISBN))>2)ORDER BY T.BOOKTITLE

SELECT DISTINCT(C.DEPT) FROM COURSE3 C WHERE NOT EXISTS(
(SELECT BOOKISBN FROM BOOKADAPTION3 WHERE COURSENO IN(

SELECT COURSENO FROM COURSE3 WHERE DEPT=C.DEPT))
EXCEPT
(SELECT BOOKISBN FROM TEXTBOOK3 WHERE PUBLISHER='MCGRAWHILL')

)

SELECT DISTINCT(T.BOOKISBN),T.BOOKTITLE FROM TEXTBOOK3 T,BOOKADAPTION3 B,COURSE3 C WHERE T.BOOKISBN=B.BOOKISBN AND C.COURSENO=B.COURSENO AND C.DEPT IN (SELECT C.DEPT FROM COURSE3 C,ENROLL3 E WHERE C.COURSENO=E.COURSENO GROUP BY C.DEPT HAVING COUNT(*)>=ALL(SELECT COUNT(*) FROM COURSE3 C,ENROLL3 E WHERE C.COURSENO=E.COURSENO GROUP BY C.DEPT))