CREATE DATABASE SHIP
USE SHIP
CREATE TABLE CUSTOMER(
CUSTOMERNO INT,
CUSTOMERNAME VARCHAR(20),
CUSTOMERCITY VARCHAR(20),
PRIMARY KEY(CUSTOMERNO)
)
INSERT INTO CUSTOMER VALUES(1,'AVINASH','MANGALORE'),(2,'ABHIJEETH','UDUPI'),(3,'UNINI','KUDREMUKHA')
CREATE TABLE ORDERS(
ORDERNO INT,
ORDERDATE DATE,
CUSTOMERNO INT,
ORDERAMOUNT INT,
PRIMARY KEY(ORDERNO),
FOREIGN KEY(CUSTOMERNO) REFERENCES CUSTOMER(CUSTOMERNO) ON DELETE CASCADE ON UPDATE CASCADE
)
INSERT INTO ORDERS VALUES(101,'2023-01-01',1,400),(102,'2023-02-01',2,500),(103,'2023-03-01',3,600),(104,'2023-04-01',1,700),(105,'2023-05-01',2,800)
CREATE TABLE ITEM(
ITEMNO INT,
PRICE INT,
PRIMARY KEY(ITEMNO)
)
INSERT INTO ITEM VALUES(201,50),(202,60),(203,70)
CREATE TABLE ORDERITEM(
ORDERNO INT,
ITEMNO INT,
QTY INT,
PRIMARY KEY(ORDERNO,ITEMNO),
FOREIGN KEY(ORDERNO) REFERENCES ORDERS(ORDERNO) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(ITEMNO) REFERENCES ITEM(ITEMNO) ON DELETE CASCADE ON UPDATE CASCADE
)
INSERT INTO ORDERITEM VALUES(101,201,5),(101,202,4),(102,201,6),(102,203,8),(103,202,7),(103,203,6),(104,201,7),(104,202,8),(105,202,6),(105,203,5)
CREATE TABLE WAREHOUSE(
WAREHOUSENO INT,
CITY VARCHAR(20),
PRIMARY KEY(WAREHOUSENO)
)
INSERT INTO WAREHOUSE VALUES(301,'CITY1'),(302,'CITY2'),(303,'CITY3')
CREATE TABLE SHIPMENT(
ORDERNO INT,
WAREHOUSENO INT,
SHIPDATE DATE,
PRIMARY KEY(ORDERNO,WAREHOUSENO),
FOREIGN KEY(ORDERNO) REFERENCES ORDERS(ORDERNO) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(WAREHOUSENO) REFERENCES WAREHOUSE(WAREHOUSENO) ON DELETE CASCADE ON UPDATE CASCADE
)
INSERT INTO SHIPMENT VALUES(101,301,'2023-01-01'),(101,302,'2023-02-01'),(102,303,'2023-03-01'),(102,301,'2023-04-01'),(103,302,'2023-05-01'),(103,303,'2023-06-01'),(104,301,'2023-07-01'),(104,302,'2023-08-01'),(105,303,'2023-09-01'),(105,301,'2023-10-01')
SELECT C.CUSTOMERNAME,COUNT(O.ORDERNO) AS 'NO O F ORDERS', AVG(O.ORDERAMOUNT) AS 'AVG ORDER AMOUNT' FROM CUSTOMER C,ORDERS O WHERE C.CUSTOMERNO=O.CUSTOMERNO GROUP BY C.CUSTOMERNAME

SELECT ITEMNO,COUNT(*) AS 'NO O F ORDERS',SUM(QTY) AS 'SUM QTY' FROM ORDERITEM   WHERE ORDERNO IN(
(SELECT ORDERNO FROM SHIPMENT  GROUP BY ORDERNO HAVING COUNT(*)>=2)) GROUP  BY ITEMNO HAVING COUNT(*)>=2 

SELECT C.CUSTOMERNAME FROM CUSTOMER C WHERE NOT EXISTS(

(SELECT ITEMNO FROM ITEM)
EXCEPT
(SELECT DISTINCT(OI.ITEMNO) FROM ORDERS O,ORDERITEM OI WHERE O.ORDERNO=OI.ORDERNO AND O.CUSTOMERNO=C.CUSTOMERNO )
)
