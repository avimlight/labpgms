CREATE DATABASE WDS
USE WDS

CREATE TABLE AUTHOR(
AUTHORID INT,
AUTHORNAME VARCHAR(20),
AUTHORCITY VARCHAR(20),
AUTHORCOUNTRY VARCHAR(20),
PRIMARY KEY(AUTHORID)
)
CREATE TABLE PUBLISHER(
PUBLISHERID INT,
PUBLISHERNAME VARCHAR(20),
PUBLISHERCITY VARCHAR(20),
PUBLISHERCOUNTRY VARCHAR(20),
PRIMARY KEY(PUBLISHERID)
)
CREATE TABLE CATEGORY(
CATEGORYID INT,
DECRIPTION VARCHAR(20),
PRIMARY KEY(CATEGORYID)
)
CREATE TABLE CATALOGS(
BOOKID INT,
TITLE VARCHAR(20),
AUTHORID INT,
PUBLISHERID INT,
CATEGORYID INT,
YEAR INT,
PRICE INT,
PRIMARY KEY(BOOKID)
)
CREATE TABLE ORDERDETAILS(
ORDERNO INT,
BOOKID INT,
QTY INT,
PRIMARY KEY(ORDERNO,BOOKID),
FOREIGN KEY(BOOKID) REFERENCES CATALOGS(BOOKID) ON DELETE CASCADE ON UPDATE CASCADE
)
INSERT INTO AUTHOR VALUES(101,'AUTHOR1','AUTHORCITY1','AUTHORCTY1'),(102,'AUTHOR2','AUTHORCITY2','AUTHORCTY2'),(103,'AUTHOR3','AUTHORCITY3','AUTHORCTY3'),(104,'AUTHOR4','AUTHORCITY4','AUTHORCTY4'),(105,'AUTHOR5','AUTHORCITY5','AUTHORCTY5')
INSERT INTO PUBLISHER VALUES(201,'PUB1','PUBCITY1','PUBCTY1'),(202,'PUB2','PUBCITY2','PUBCTY2'),(203,'PEARSON','PUBCITY3','PUBCTY3'),(204,'PUB4','PUBCITY4','PUBCTY4'),(205,'PEARSON','PUBCITY5','PUBCTY5')
INSERT INTO CATEGORY VALUES(301,'FICTION'),(302,'NONFICTION'),(303,'SCIFI'),(304,'ANIMATED'),(305,'COMEDIC')
INSERT INTO CATALOGS VALUES(401,'BOOK1',101,201,301,2005,50),(402,'BOOK2',101,202,302,2006,60),(403,'BOOK3',102,201,303,2007,70),(404,'BOOK4',102,203,301,2008,80),(405,'BOOK5',103,201,302,2009,90),(406,'BOOK6',103,202,303,2010,100),(407,'BOOK7',104,202,301,2011,90),(408,'BOOK8',104,203,302,2012,100)
INSERT INTO ORDERDETAILS VALUES(501,401,5),(501,402,6),(502,403,7),(502,404,8),(503,405,9),(503,406,10),(504,407,11),(504,408,12)

SELECT A.AUTHORID,A.AUTHORNAME,A.AUTHORCITY,C.BOOKID,SUM(O.QTY) AS 'SUM_QTY' INTO TB_AUTH FROM AUTHOR A,CATALOGS C,ORDERDETAILS O WHERE A.AUTHORID=C.AUTHORID AND C.BOOKID=O.BOOKID GROUP BY A.AUTHORID,A.AUTHORNAME,A.AUTHORCITY,C.BOOKID
SELECT *FROM TB_AUTH WHERE SUM_QTY IN (SELECT MAX(SUM_QTY) FROM TB_AUTH)

UPDATE CATALOGS SET PRICE=PRICE*1.1 WHERE PUBLISHERID IN(SELECT PUBLISHERID FROM PUBLISHER WHERE PUBLISHERNAME='PEARSON')
SELECT COUNT(ORDERNO) AS 'NO O F ORDERS',BOOKID FROM ORDERDETAILS GROUP BY BOOKID HAVING SUM(QTY)<=ALL(SELECT SUM(QTY) FROM ORDERDETAILS GROUP BY BOOKID)
